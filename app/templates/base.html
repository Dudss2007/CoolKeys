{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CoolKeys{% endblock %}</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body class="d-flex flex-column min-vh-100">

    <header>
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #011526;"> 
    <div class="container-fluid px-0 px-sm-3">
        
        {# LOGO #}
        <a class="navbar-brand" href="{% url 'home' %}">
            <img class="pl-2" src="{% static 'img/image11.png' %}" alt="Logo" style="height: 40px; width: auto;">
        </a>
        
        {# NOVO: ITENS DE AÇÃO VISÍVEIS FORA DO COLLAPSE (PARA MOBILE) #}
        <div class="d-flex order-lg-3 align-items-center">
            
            {# 1. Ícone do Carrinho (Visível em Mobile) #}
            <li class="nav-item list-unstyled mr-3 d-lg-none"> {# Oculta no desktop, mostra no mobile #}
                <a class="nav-link cart-link-container" href="{% url 'carrinho' %}" style="padding-right: 0;">
                    <i class="fas fa-shopping-cart fa-lg text-white"></i>
                    {% if total_itens_carrinho > 0 %}
                    <span class="badge-posicao-fixa">
                        +{{ total_itens_carrinho }}
                    </span>
                    {% endif %}
                </a>
            </li>

            {# 2. Ícone do Usuário (Visível em Mobile) #}
            <li class="nav-item dropdown list-unstyled d-lg-none"> {# Oculta no desktop, mostra no mobile #}
                <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" style="padding-right: 0;">
                    <i class="fas fa-user fa-lg text-white"></i>
                </a>
                {# O conteúdo do dropdown-menu é o mesmo de baixo #}
                <div class="dropdown-menu dropdown-menu-right">
                    {# ... CONTEÚDO DO DROPDOWN DO USUÁRIO AQUI ... #}
                    <div>
                        {% if user.is_authenticated %}
                            <h6 class="dropdown-header">Olá, {{ user.username }}</h6>
                            <a class="dropdown-item" href="{% url 'perfil' %}"><i class="fas fa-id-card fa-fw mr-2"></i> Perfil</a>
                            {% if user.is_superuser or user.groups.all.0.name == 'admin_staff' %}
                            <a class="dropdown-item" href="{% url 'dashboard' %}"><i class="fas fa-tachometer-alt fa-fw mr-2"></i> Dashboard Admin</a>
                            {% endif %}
                            <div class="dropdown-divider"></div>
                            <form method="post" action="{% url 'logout' %}" style="margin-bottom: 0;">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item"><i class="fas fa-sign-out-alt fa-fw mr-2"></i> Sair</button>
                            </form>
                        {% else %}
                            <h6 class="dropdown-header">Bem-vindo(a)!</h6>
                            <a class="dropdown-item" href="{% url 'login' %}"><i class="fas fa-sign-in-alt fa-fw mr-2"></i> Entrar</a>
                            <a class="dropdown-item" href="{% url 'cadastro' %}"><i class="fas fa-user-plus fa-fw mr-2"></i> Cadastrar</a>
                        {% endif %}
                    </div>
                </div>
            </li>
            
            {# BOTÃO DO MENU HAMBÚRGUER #}
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMain">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>


        {# CONTEÚDO PRIMÁRIO (COLAPSO) #}
        <div class="collapse navbar-collapse order-lg-2" id="navbarMain">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
                
                {# DROPDOWN CATEGORIAS #}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">Categorias</a>
                    <div class="dropdown-menu">
                        {% for categoria in categorias %}
                            <a href="{% url 'detalhe_categoria' categoria.id %}" class="dropdown-item">{{ categoria.nome }}</a>
                        {% endfor %}
                    </div>
                </li>
            </ul>

            {# BUSCA (Ajustada) - Aparece no Desktop e dentro do collapse no Mobile #}
            <form action="{% url 'resultado_pesquisa' %}" method="get" class="form-inline mx-lg-auto my-2 my-lg-0 w-100" style="max-width: 400px;"> 
                {# AQUI ESTÁ A CORREÇÃO PRINCIPAL DE LARGURA #}
                <input id="search-input" name="q" class="form-control w-100" type="search" placeholder="Buscar jogo..." style="border-radius: 50px;">
                <button type="submit" style="display: none;">Buscar</button>
            </form>

            {# UTILITÁRIOS (Carrinho e Usuário) - VISÍVEL APENAS NO DESKTOP (d-none d-lg-flex) #}
            <ul class="navbar-nav align-items-center d-none d-lg-flex"> 
                <li class="nav-item mr-3">
                    <a class="nav-link cart-link-container" href="{% url 'carrinho' %}" style="padding-right: 0;">
                        <i class="fas fa-shopping-cart fa-lg"></i>
                        {% if total_itens_carrinho > 0 %}
                        <span class="badge-posicao-fixa">
                            +{{ total_itens_carrinho }}
                        </span>
                        {% endif %}
                    </a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" style="padding-right: 0;">
                        <i class="fas fa-user fa-lg"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        {# ... CONTEÚDO DO DROPDOWN DO USUÁRIO AQUI ... #}
                        <div>
                            {% if user.is_authenticated %}
                                <h6 class="dropdown-header">Olá, {{ user.username }}</h6>
                                <a class="dropdown-item" href="{% url 'perfil' %}"><i class="fas fa-id-card fa-fw mr-2"></i> Perfil</a>
                                {% if user.is_superuser or user.groups.all.0.name == 'admin_staff' %}
                                <a class="dropdown-item" href="{% url 'dashboard' %}"><i class="fas fa-tachometer-alt fa-fw mr-2"></i> Dashboard Admin</a>
                                {% endif %}
                                <div class="dropdown-divider"></div>
                                <form method="post" action="{% url 'logout' %}" style="margin-bottom: 0;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item"><i class="fas fa-sign-out-alt fa-fw mr-2"></i> Sair</button>
                                </form>
                            {% else %}
                                <h6 class="dropdown-header">Bem-vindo(a)!</h6>
                                <a class="dropdown-item" href="{% url 'login' %}"><i class="fas fa-sign-in-alt fa-fw mr-2"></i> Entrar</a>
                                <a class="dropdown-item" href="{% url 'cadastro' %}"><i class="fas fa-user-plus fa-fw mr-2"></i> Cadastrar</a>
                            {% endif %}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
    </header>
    
    <div class="container-fluid flex-grow-1 p-0">
        {% block conteudo %}     
        {% endblock %}
    </div> 

    <footer class="mt-auto">
        <div class="container d-flex flex-wrap justify-content-between align-items-center py-4">
            <p class="col-md-4 mb-0 text-muted">© 2025 CoolKeys</p>

            <div class="col-md-4 d-flex align-items-center justify-content-center">
                <a href="https://www.instagram.com/ian__lamartine/" class="text-muted mr-3"><i class="fab fa-instagram fa-2x"></i></a>
                <a href="https://github.com/IanSeed/CoolKeys/tree/main" class="text-muted"><i class="fab fa-github fa-2x"></i></a>
            </div>

            <ul class="nav col-md-4 justify-content-end">
                <li class="nav-item"><a href="{% url 'suporte' %}" class="nav-link px-2 text-muted">Suporte</a></li>
                <li class="nav-item"><a href="{% url 'faq' %}" class="nav-link px-2 text-muted">FAQ</a></li>
            </ul>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> 
    
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(function() {
            var searchInput = $("#search-input");
            var searchForm = searchInput.closest('form'); 
            
            searchInput.autocomplete({
                source: "{% url 'autocomplete_search' %}",
                minLength: 2,
                select: function(event, ui) {
                    window.location.href = '/jogo/detalhe/' + ui.item.id; 
                    return false;
                }
            })
            
            .autocomplete("instance")._renderItem = function(ul, item) {
                
                var listItem = $("<li>")
                    .appendTo(ul);
                    
                var content = $("<div>")
                    .addClass("search-autocomplete-item")
                    .append(
                        $("<img>")
                            .attr("src", item.icon_url)
                            .attr("alt", item.label)
                            .addClass("game-icon"),
                        $("<span>")
                            .text(item.label)
                            .addClass("game-title")
                    )
                    .appendTo(listItem);
                    
                return listItem;
            };

            searchInput.on('keydown', function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault(); 
                    searchForm.submit();
                }
            });
        });
    </script>
</body>
</html>