{% extends 'base.html' %}

{% block title %}Detalhes do Jogo - {{ jogo.nome }}{% endblock %}

{% block conteudo %}
<div class="container py-4">
    
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb" style="background: transparent; padding-left: 0;">
            <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-decoration-none text-muted">Home</a></li>
            {% if jogo.categoria %}
            <li class="breadcrumb-item"><a href="/categoria/{{ jogo.categoria.id }}" class="text-decoration-none text-muted">{{ jogo.categoria.nome }}</a></li>
            {% endif %}
            <li class="breadcrumb-item active text-light" aria-current="page">{{ jogo.nome }}</li>
        </ol>
    </nav>

    <div class="main-game-card mb-5">
        <div class="row g-0"> 
            
            <div class="col-lg-7 d-flex flex-column border-end border-secondary" style="border-right-color: rgba(255,255,255,0.1) !important;">
                
                {% if jogo.icone %}
                    <img src="{{ jogo.icone.url }}" alt="{{ jogo.nome }}" class="main-game-image">
                {% else %}
                    <img src="https://via.placeholder.com/800x600?text=Sem+Imagem" alt="{{ jogo.nome }}" class="main-game-image">
                {% endif %}

                <div class="px-4 px-md-5 pb-4 pb-md-5 pt-3 bg-opacity-10" style="background: rgba(0,0,0,0.2); flex-grow: 1;">
                    <h3 class="text-white mb-3" style="font-size: 1.5rem; font-weight: 700; border-bottom: 2px solid #048ABF; display: inline-block; padding-bottom: 5px;">
                        Sobre o Jogo
                    </h3>
                    <p class="text-light mb-0" style="opacity: 0.9; font-size: 1rem; line-height: 1.7;">
                        {{ jogo.descricao|linebreaksbr }}
                    </p>
                </div>
            </div>
            
            <div class="col-lg-5 p-4 p-md-5 d-flex flex-column" style="background: rgba(0,0,0,0.2);">
                
                <h1 class="game-title text-white fw-bold display-5 mb-2">{{ jogo.nome }}</h1>
                
                <div class="mb-4">
                    {% if jogo.categoria %}
                    <span class="badge bg-primary">{{ jogo.categoria.nome }}</span>
                    {% endif %}
                </div>
                
                <div class="p-4 rounded mb-auto" style="background-color: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);">
                    
                    <div class="mb-4">
                        {% if jogo.desconto and jogo.desconto > 0 %}
                            <small class="text-white-50 d-block text-uppercase fw-bold mb-1">Oferta Especial</small>
                            
                            <div class="d-flex align-items-center mb-2">
                                <span class="price-old-strikethrough">
                                    R$ {{ jogo.preco|floatformat:2 }}
                                </span>
                                <span class="discount-tag-red">
                                    -{{ jogo.desconto }}%
                                </span>
                            </div>
                            <div class="price-new-neon h1 mb-0">
                                R$ {{ jogo.preco_com_desconto|floatformat:2 }}
                            </div>

                        {% else %}
                            <div class="d-flex flex-column">
                                <div class="h1 text-white font-weight-bold mb-0">R$ {{ jogo.preco|floatformat:2 }}</div>
                            </div>
                        {% endif %}
                    </div>
                    
                    {% if not jogo.deletado %}
                        {% if user.is_authenticated %}
                            <form method="POST" action="{% url 'adicionar_carrinho' jogo.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-add-neon btn-lg w-100 py-3">
                                    <i class="fas fa-shopping-cart me-2"></i> ADICIONAR AO CARRINHO
                                </button>
                            </form>
                        {% else %}
                            <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg w-100 py-3">
                                Faça Login para Comprar
                            </a>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-danger text-center font-weight-bold">
                            Produto Indisponível
                        </div>
                    {% endif %}
                </div>

                <div class="game-info-box mt-4">
                    <div class="row text-center">
                        <div class="col-4 border-end border-secondary">
                            <div class="info-label">Categoria</div>
                            <div class="info-value cyan">
                                {% if jogo.categoria %}{{ jogo.categoria.nome }}{% else %}Geral{% endif %}
                            </div>
                        </div>
                        <div class="col-4 border-end border-secondary">
                            <div class="info-label">Editora</div>
                            <div class="info-value">CoolKeys</div>
                        </div>
                        <div class="col-4">
                            <div class="info-label">Lançamento</div>
                            <div class="info-value">2025</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    {% if jogos_relacionados %}
    <div class="mt-5 pt-3 border-top border-secondary">
        <h2 class="mb-4 text-white">Jogos Relacionados</h2>
        <div class="row g-4">
            {% for jogo_rel in jogos_relacionados %}
            <div class="col-md-4 col-lg-3">
                <div class="game-card h-100 d-flex flex-column">
                    <a href="{% url 'jogo_detalhe' jogo_rel.id %}" class="text-decoration-none text-white d-flex flex-column h-100">
                        <div class="game-card-img-container position-relative">
                            {% if jogo_rel.icone %}
                                <img src="{{ jogo_rel.icone.url }}" alt="{{ jogo_rel.nome }}" class="img-padrao-capa">
                            {% else %}
                                <img src="https://via.placeholder.com/300x200?text=GAME" alt="{{ jogo_rel.nome }}" class="img-padrao-capa">
                            {% endif %}
                        </div>
                        <div class="game-card-body p-3 d-flex flex-column flex-grow-1">
                            <h5 class="card-title text-truncate mb-auto" style="font-weight: 700; font-size: 1rem;">{{ jogo_rel.nome }}</h5>
                            
                            <div class="d-flex justify-content-between align-items-end mt-3">
                                <div>
                                    {% if jogo_rel.desconto and jogo_rel.desconto > 0 %}
                                        <div class="d-flex align-items-center mb-1">
                                            <span class="price-old-strikethrough" style="font-size: 0.8rem; margin-right: 5px;">
                                                R$ {{ jogo_rel.preco|floatformat:2 }}
                                            </span>
                                            <span class="discount-tag-red" style="font-size: 0.7rem; padding: 2px 5px;">
                                                -{{ jogo_rel.desconto }}%
                                            </span>
                                        </div>
                                        <div class="price-new-neon" style="font-size: 1.1rem;">
                                            R$ {{ jogo_rel.preco_com_desconto|floatformat:2 }}
                                        </div>
                                    {% else %}
                                        <div class="game-card-price fw-bold" style="color: #048ABF; font-size: 1.1rem;">
                                            R$ {{ jogo_rel.preco|floatformat:2 }}
                                        </div>
                                    {% endif %}
                                </div>
                                <span class="btn btn-sm btn-neon-animate mb-1">Ver</span>
                            </div>
                            </div>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}